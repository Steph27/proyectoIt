<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
        <div class="offcanvas-header">
            <h4 class="offcanvas-title" id="offcanvasRightLabel">Mi Compra</h4>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        
        <div class="offcanvas-body"></div>
        
        <div class="offcanvas-footer container">
            <div id="procesarCompra">
                <button type="button" id="procesarCompra" class="btn btn-outline-success">
                Continuar compra
                </button>
                <button type="button" class="btn btn-outline-danger" id="vaciarCarrito">
                Vaciar carrito
                </button>
            </div>
                <h6>Precio total:</h6>
                <p class="text-center" id="precioTotal"></p>
        </div>
        
</div>

<script>

let carrito = []

const carritoContenedor = document.getElementById('carritoContenedor');
const vaciarCarrito = document.getElementById('vaciarCarrito');
const precioTotal = document.getElementById('precioTotal');
const procesarCompra = document.getElementById('procesarCompra');
const btnComprar = document.getElementById('btnComprar');

document.addEventListener('DOMContentLoaded',() =>{
    carrito = JSON.parse(localStorage.getItem('carrito')) || []
    mostrarCarrito();
})


procesarCompra.addEventListener('click', () =>{
    console.log('Estoy entrando en el boton de procesar compra');
    if (carrito.length === 0){
        Swal.fire({
            title:"Tu carrito esta vacio",
            text:"Compra algo para continuar",
            icon:"error",
            confirmButtonText:"Aceptar",
        
        })
    }else {
    location.href="/checkout" 
    }
});

vaciarCarrito.addEventListener('click', () =>{
    carrito.length = [];
    mostrarCarrito();
});


function agregarProducto(id){

    const existe = carrito.some(prod => prod.id === id)

    if (existe){
        const prod = carrito.map(prod => {
            if(prod.id === id){
                prod.cantidad ++
            }
        })
    }else {
        const item = stockAuriculares.find((prod) => prod.id === id)
        carrito.push(item);
    }
    mostrarCarrito(); 
}


btnComprar.addEventListener('click', () => {
    console.log("al menos entro aqui");
});

const mostrarCarrito = () => {
    const offcanvasBody = document.querySelector('.offcanvas .offcanvas-body');

    offcanvasBody.innerHTML = ''
    carrito.forEach((prod) => {
        const {id, nombre, img, desc,cantidad, precio} = prod
        offcanvasBody.innerHTML += `
        <div class="offcanvas-contenedor">
            <div>
            <img class="img-fluid img-carrito" src="${img}"/>
            </div>
        </div>
        <p>Producto:${nombre}</p>
        <p>Precio:${precio}</p>
        <p>Cantidad:${cantidad}</p>
        
        <button onclick="eliminarProducto(${id})" class="btn btn-outline-danger"> Eliminar producto</button>
        </div>

        `
    })

    if(carrito.length === 0){
        offcanvasBody.innerHTML = `
        <p class="text-center parrafo">¡Aún no agregaste nada!</p>
        `
    }

    carritoContenedor.textContent = carrito.length;

precioTotal.innerText = carrito.reduce((acumulador,prod) => acumulador + prod.cantidad * prod.precio , 0)

    guardarStorage();
}

function eliminarProducto(id){
    const productoId = id;
    carrito = carrito.filter((producto) => producto.id != productoId);
    mostrarCarrito();
}

function guardarStorage(){
    localStorage.setItem("carrito",JSON.stringify(carrito));
}

</script>